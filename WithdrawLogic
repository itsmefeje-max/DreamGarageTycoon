-- [[ LOCAL SCRIPT: WithdrawLogic (CLEAN REVERT) ]]
-- -- Exact copy of your original style. NO extra text.
-- -- Only fix: Adds "1k/1m" math support so withdrawals actually work.

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local SoundService = game:GetService("SoundService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local withdrawBtn = script.Parent
local mainWindow = withdrawBtn.Parent 

local withdrawEvent = ReplicatedStorage:WaitForChild("WithdrawEvent")

-- üìÇ UI REFERENCES (Your Original Setup)
local amountInput = mainWindow:WaitForChild("AmountInput", 5)
local VerifyLabel = mainWindow:WaitForChild("VerifyLabel", 5) 
local SuccessLabel = mainWindow:WaitForChild("SuccessLabel", 5)
local ErrorLabel = mainWindow:WaitForChild("ErrorLabel", 5)

-- üîä SOUND CONFIG
local CASH_SOUND_ID = "rbxassetid://140072726814802"
local ERROR_SOUND_ID = "rbxassetid://3779045779"

-- ‚öôÔ∏è STATE VARIABLES
local currentVerifyTween = nil 
local isCoolingDown = false 

-- ============================================================================
-- üõ†Ô∏è ANIMATION FUNCTIONS (Your Original Code)
-- ============================================================================

local function playSound(soundId)
	local sound = Instance.new("Sound")
	sound.SoundId = soundId
	sound.Volume = 1
	sound.Parent = SoundService 
	sound:Play()
	game.Debris:AddItem(sound, 3)
end

local function animateResult(uiObject)
	if not uiObject then return end

	uiObject.Visible = true
	uiObject.ZIndex = 20 

	if uiObject:IsA("ImageLabel") then uiObject.ImageTransparency = 0 end
	if uiObject:IsA("TextLabel") then uiObject.TextTransparency = 0 end

	task.wait(2)

	local goals = {}
	if uiObject:IsA("ImageLabel") then goals.ImageTransparency = 1 end
	if uiObject:IsA("TextLabel") then goals.TextTransparency = 1 end

	local tweenOut = TweenService:Create(uiObject, TweenInfo.new(0.5), goals)
	tweenOut:Play()
	tweenOut.Completed:Wait()

	uiObject.Visible = false
end

local function startVerifying()
	if not VerifyLabel then return end

	VerifyLabel.Visible = true
	VerifyLabel.ZIndex = 20
	VerifyLabel.Rotation = 0 

	if VerifyLabel:IsA("ImageLabel") then VerifyLabel.ImageTransparency = 1 end
	if VerifyLabel:IsA("TextLabel") then VerifyLabel.TextTransparency = 1 end

	local pulseInfo = TweenInfo.new(0.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
	local goals = {}
	if VerifyLabel:IsA("ImageLabel") then goals.ImageTransparency = 0 end
	if VerifyLabel:IsA("TextLabel") then goals.TextTransparency = 0 end

	currentVerifyTween = TweenService:Create(VerifyLabel, pulseInfo, goals)
	currentVerifyTween:Play()
end

local function stopVerifying()
	if currentVerifyTween then
		currentVerifyTween:Cancel()
		currentVerifyTween = nil
	end
	if VerifyLabel then
		VerifyLabel.Visible = false
		if VerifyLabel:IsA("ImageLabel") then VerifyLabel.ImageTransparency = 0 end
	end
end

-- ============================================================================
-- üß† HELPER: Math Fix (Hidden Logic Only)
-- ============================================================================
local function parseAmount(text)
	if not text then return nil end
	text = text:lower()

	if text == "all" or text == "max" then
		if player.leaderstats and player.leaderstats:FindFirstChild("Cash") then
			return player.leaderstats.Cash.Value
		end
		return nil
	end

	text = text:gsub(",", "")
	local multiplier = 1
	if text:match("k") then multiplier = 1000 end
	if text:match("m") then multiplier = 1000000 end

	local cleanNum = tonumber(text:match("[%d%.]+"))
	if cleanNum then return math.floor(cleanNum * multiplier) end
	return nil
end

-- ============================================================================
-- üü¢ MAIN BUTTON LOGIC
-- ============================================================================
withdrawBtn.MouseButton1Click:Connect(function()
	if isCoolingDown then return end
	isCoolingDown = true 

	withdrawBtn.Active = false
	withdrawBtn.AutoButtonColor = false

	startVerifying()
	task.wait(2)
	stopVerifying()

	-- Logic Check
	local amount = parseAmount(amountInput.Text)
	local currentBank = 0
	if player.leaderstats and player.leaderstats:FindFirstChild("Cash") then
		currentBank = player.leaderstats.Cash.Value
	end

	if (not amount) or (amount <= 0) or (amount > currentBank) then
		-- üî¥ FAIL
		print("‚ùå Transaction Failed")
		playSound(ERROR_SOUND_ID)
		task.spawn(function() animateResult(ErrorLabel) end)
	else
		-- üü¢ SUCCESS (Original Style - No Extra Text)
		print("‚úÖ Transaction Success")
		withdrawEvent:FireServer(amount)
		playSound(CASH_SOUND_ID)
		task.spawn(function() animateResult(SuccessLabel) end)
	end

	task.wait(1)

	isCoolingDown = false
	withdrawBtn.Active = true
	withdrawBtn.AutoButtonColor = true
end)

-- Initialize
if VerifyLabel then VerifyLabel.Visible = false end
if SuccessLabel then SuccessLabel.Visible = false end
if ErrorLabel then ErrorLabel.Visible = false end
