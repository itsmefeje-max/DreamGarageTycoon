-- [[ SERVER SCRIPT: AdminCommands (Everything Update) ]]
-- -- Indicating what the script is for: Admin commands to give items or "everything".
-- Usage: /give <target> <item_name> [amount]
-- Example: /give @s delta
-- Special: /give @s everything (Gives one of EVERY tool)

local Players = game:GetService("Players")
local ServerStorage = game:GetService("ServerStorage")

-- âš™ï¸ CONFIGURATION
local CarTools = ServerStorage:WaitForChild("CarTools") 
local ADMIN_USER_IDS = {
	[5512860740] = true, -- Your ID
}
local ALLOW_STUDIO_ADMIN = true 

-- ============================================================================
-- ğŸ¯ TARGET SELECTOR LOGIC
-- ============================================================================
local function getTargets(speaker, selector)
	local targets = {}
	local allPlayers = Players:GetPlayers()

	if selector == "@s" then
		table.insert(targets, speaker)
	elseif selector == "@a" then
		targets = allPlayers
	elseif selector == "@r" then
		if #allPlayers > 0 then table.insert(targets, allPlayers[math.random(1, #allPlayers)]) end
	elseif selector == "@p" then
		if not speaker.Character or not speaker.Character.PrimaryPart then return {} end
		local myPos = speaker.Character.PrimaryPart.Position
		local closestDist, closestPlayer = math.huge, nil
		for _, p in pairs(allPlayers) do
			if p ~= speaker and p.Character and p.Character.PrimaryPart then
				local dist = (p.Character.PrimaryPart.Position - myPos).Magnitude
				if dist < closestDist then closestDist = dist; closestPlayer = p end
			end
		end
		table.insert(targets, closestPlayer or speaker)
	else
		-- Name Match (Case Insensitive)
		for _, p in pairs(allPlayers) do
			if p.Name:lower():sub(1, #selector) == selector:lower() then
				table.insert(targets, p)
				break 
			end
		end
	end
	return targets
end

-- ============================================================================
-- ğŸ’ ITEM GIVING LOGIC
-- ============================================================================
local function findToolCaseInsensitive(itemName)
	local targetName = itemName:lower()

	for _, tool in pairs(CarTools:GetChildren()) do
		if tool:IsA("Tool") then
			local toolName = tool.Name:lower()
			-- Check 1: Exact Match
			if toolName == targetName then return tool end
			-- Check 2: With " item" suffix
			if toolName == targetName .. " item" then return tool end
			-- Check 3: With "item" suffix
			if toolName == targetName .. "item" then return tool end
		end
	end
	return nil
end

local function giveItem(player, tool, quantity)
	for i = 1, quantity do
		tool:Clone().Parent = player.Backpack
		tool:Clone().Parent = player.StarterGear
	end
end

-- ============================================================================
-- ğŸ’¬ CHAT PARSER
-- ============================================================================
Players.PlayerAdded:Connect(function(player)
	player.Chatted:Connect(function(message)
		local isAdmin = ADMIN_USER_IDS[player.UserId] or (ALLOW_STUDIO_ADMIN and game.PlaceId == 0)
		if not isAdmin then return end

		local args = message:split(" ")
		if args[1]:lower() ~= "/give" then return end

		local selector = args[2]
		local itemName = args[3]
		local amount = tonumber(args[4]) or 1 

		if not selector or not itemName then
			warn("âŒ Usage: /give <target> <item> [amount]")
			return
		end

		local targetPlayers = getTargets(player, selector)
		if #targetPlayers == 0 then
			warn("âŒ No targets found for: " .. selector)
			return
		end

		-- ğŸŒŸ SPECIAL "EVERYTHING" COMMAND ğŸŒŸ
		if itemName:lower() == "everything" or itemName:lower() == "all" then
			print("ğŸ GIVING EVERYTHING to targets...")
			
			for _, target in pairs(targetPlayers) do
				local count = 0
				for _, tool in pairs(CarTools:GetChildren()) do
					if tool:IsA("Tool") then
						giveItem(target, tool, 1)
						count = count + 1
					end
				end
				print("âœ… Gave " .. count .. " items to " .. target.Name)
			end
			return
		end

		-- ğŸ“¦ NORMAL ITEM COMMAND
		local tool = findToolCaseInsensitive(itemName)
		if tool then
			for _, target in pairs(targetPlayers) do
				giveItem(target, tool, amount)
				print("âœ… Gave " .. amount .. "x [" .. tool.Name .. "] to " .. target.Name)
			end
		else
			warn("âŒ Could not find item: " .. itemName)
		end
	end)
end)
