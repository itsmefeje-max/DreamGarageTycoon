-- [[ LOCAL SCRIPT: PadRainbowClient (TAG FIX) ]]
-- Purpose: Animates parts tagged with "RainbowEffect".
-- Location: StarterPlayerScripts

local RunService = game:GetService("RunService")
local CollectionService = game:GetService("CollectionService") -- ‚úÖ Using CollectionService

-- ‚öôÔ∏è CONFIGURATION
local RAINBOW_SPEED = 0.2
local SATURATION = 1
local VALUE = 1

-- üîç TRACKING
local rainbowParts = {}

-- üåà ANIMATION LOOP
RunService.Heartbeat:Connect(function()
	local hue = (tick() * RAINBOW_SPEED) % 1
	local color = Color3.fromHSV(hue, SATURATION, VALUE)

	for part, _ in pairs(rainbowParts) do
		if part and part.Parent then
			part.Color = color
		else
			rainbowParts[part] = nil
		end
	end
end)

-- üõ†Ô∏è TRACKING HELPERS
local function onTagAdded(part)
	if part:IsA("BasePart") then
		rainbowParts[part] = true
	end
end

local function onTagRemoved(part)
	rainbowParts[part] = nil
end

-- üì° START LISTENING
-- 1. Get all existing parts (that loaded before script started)
for _, part in ipairs(CollectionService:GetTagged("RainbowEffect")) do
	onTagAdded(part)
end

-- 2. Listen for new parts (Streamed in or newly painted)
-- This is 100% reliable unlike AttributeChanged
CollectionService:GetInstanceAddedSignal("RainbowEffect"):Connect(onTagAdded)
CollectionService:GetInstanceRemovedSignal("RainbowEffect"):Connect(onTagRemoved)
